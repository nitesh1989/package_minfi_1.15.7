<tool id="get_beta" name="Get Beta values from RGset" version="1.0">
    <description>Read in RGset and produce matrix of Beta values</description>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <requirements>
        <requirement type="R-module" version="1.15.7">minfi</requirement>
    </requirements>
    <command>
        Rscript "${get_beta_values}"
    </command>
    <inputs>
        <param name="preprocess_method" type="select" label="Select Preprocessing Method">
            <option value="quantile">Quantile Normalization</option>
            <option value="raw">Raw Normalization</option>
            <option value="noob">Noob Normalization</option>
        </param>
        <param name="RGset" type="data" format="RData" label="Input RGset" />
    </inputs>
    <configfiles>
        <configfile name="get_beta_values"><![CDATA[
            ### Read in the RGset from the "read_450k_IDAT" tool
            load($RGset)

            ## Preprocess data
            if($preprocess_method.name) == "quantile"{
                normalized_RGset = preprocessQuantile(RGset)
            } else if ($preprocess_method.name == "noob"){
                normalized_RGset = preprocessNoob(RGset)
            } else {
                normalized_RGset = preprocessRaw(RGset)
            }

            ## Get beta values from Proprocessed data
            beta = getBeta(normalized_RGset)

            ## Save beta values
            write.table(beta,file = "beta_values.txt",quote=FALSE,row.names=FALSE)

        ]]></configfile>
    </configfiles>
    <outputs>
        <data name="output1" format="txt" from_work_dir="beta_values.txt" />
    </outputs>
    <help><![CDATA[

    What it does

    A ‘MethylSet’ stores ‘meth’ and ‘Unmeth’.  From these it is easy
    to compute Beta values, defined as

    Beta = Meth / (Meth + Unmeth + offset)


    Extract beta values from RGset of the IDAT files.

    ]]></help>
</tool>